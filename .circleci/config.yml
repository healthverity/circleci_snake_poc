version: 2.1

executors:
  runner:
    machine: true
    resource_class: runnerpoc/test

  python-docker:
    docker:
      - image: cimg/python-3.7

workflows:
  test:
    jobs:
      - build
      - lint:
          requires:
            - build
      - typecheck:
          requires:
            - build
      - unit-test:
          requires:
            - build
      - e2e-test:
          requires:
            - build

jobs:
  build:
    executor: runner
    steps:
      - checkout
      - run: 
          command: make build
          environment:
            VERSION: "0.0.0"

  lint:
    executor: runner
    steps:
      - checkout
      - run: make lint

  typecheck:
    executor: runner
    steps:
      - checkout
      - run: make typecheck

  unit-test:
    executor: runner
    steps:
      - checkout
      - run: make run-tests

  e2e-test:
    executor: runner
    steps:
      - checkout
      - run: make run-e2e-tests
